<%- model_class = User -%>
<div class="page-header">

  <h1>User List</h1>
  <p>
    The table below list all currently registered service users. To see
    more details about the user account, you can click on the account
    email or the 'show' button. If you want 'edit' or 'destroy', the
    corresponding buttons are also availabe for each account record.
  </p>

    <!-- Form for submitting a search request -->
  <%= form_tag users_url, method: :get do %>
    <div class='row collapse'>
      <div class='small-6 medium-2 columns'>
        <%= select_tag(:stype, user_search_options) %>
      </div>

      <div class='small-6 medium-3 columns'>
        <%= text_field_tag :search, nil, placeholder: "Search term" %>
      </div>

      <div class='small-12 medium-6 medium-offset-1 columns end'>
        <label>Filter results by:</label>
        <%= radio_button_tag(:role_filter, :both, true) %>
        <label class='radio'>Both &nbsp&nbsp</label>

        <%= radio_button_tag(:role_filter, :customer, false) %>
        <label class='radio'>Customer &nbsp&nbsp</label>

        <%= radio_button_tag(:role_filter, :service_admin, false) %>
        <label class='radio'>Service Admin</label>
      </div>
    </div>

    <div class='row'>
      <div class='small-12 columns'>
        <%= submit_tag 'Search/Filter', class: 'button radius tiny secondary' %>
      </div>
    </div>
  <% end %>

</div> <!-- page header -->

<%= render partial: 'shared/flash', locals: { flash: flash } %>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Email</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Phone</th>
      <th>Role</th>
      <th>Organization</th>
      <th>Last Sign In</th>
      <th>Last IP</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= link_to user.email, user_path(user) %></td>
        <td><%= user.first_name %></td>
        <td><%= user.last_name %></td>
        <td><%= number_to_phone(user.phone, delimiter: ".") %></td>
        <td><%= user.role_str %></td>
        <% if user.organization.present? %>
          <td>
            <%= user.organization.name %><br/>
          </td>
        <% else %>
          <td>None</td>
        <% end %>
        <td><%= user.last_sign_in_at %></td>
        <td><%= user.last_sign_in_ip %></td>

        <td>
          <%= link_to t('.show', :default => t("helpers.links.show")),
                      user_path(user), :class => 'intable-success-button' %>
          <%= link_to t('.edit', :default => t("helpers.links.edit")),
                      edit_user_path(user), :class => 'intable-grey-button' %>
          <%= link_to t('.delete', :default => t("helpers.links.destroy")),
                      user_path(user),
                      :method => :delete,
                      :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                      :class => 'intable-delete-button' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class='digg_pagination'>
  <%= will_paginate @users %>
</div>

<div class="form-actions">
  <%= link_to t('.new', default: t("helpers.links.new")),
    new_user_path, class: 'success-button' %>
</div>
